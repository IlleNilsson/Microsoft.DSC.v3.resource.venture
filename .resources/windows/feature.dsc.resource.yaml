$schema: https://aka.ms/dsc/schemas/v3/bundled/resource/manifest.vscode.json
type: Visity.DSC.Windows/Feature
version: 0.1.0
description: Windows OS Edition agnostic feature handling (WindowsFeature for Server & WindowsOptionalFeature for Clients)
# kind: resource
tags:
  - os
  - windows
  - client
  - server
  - agnostic
  - feature
  - optional

validate:
  executable: pwsh
  args:
    - -File './feature.dsc.resource.ps1' 
    - -NoLogo
    - -NonInteractive
    - -NoProfile
    - -NoProfileLoadTime
    - -WindowStyle Hidden
    - -CommandWithArgs Request-FeatureState -Validate
  input: stdin

get:
  executable: pwsh
  args:
    - -File './feature.dsc.resource.ps1' 
    - -NoLogo
    - -NonInteractive
    - -NoProfile
    - -NoProfileLoadTime
    - -WindowStyle Hidden
    - -CommandWithArgs Request-FeatureState -Get -Name 'Microsoft-Hyper-V'
  input: stdin
  return: state

test:
  executable: pwsh
  args:
    - -File './feature.dsc.resource.ps1' 
    - -NoLogo
    - -NonInteractive
    - -NoProfile
    - -NoProfileLoadTime
    - -WindowStyle Hidden
    - -CommandWithArgs Request-FeatureState -Test -Name 'Microsoft-Hyper-V' -Ensure Enabled
  input: stdin
  return: state

set:
  executable: pwsh
  args:
    - -File './feature.dsc.resource.ps1' 
    - -NoLogo
    - -NonInteractive
    - -NoProfile
    - -NoProfileLoadTime
    - -WindowStyle Hidden
    - -CommandWithArgs Request-FeatureState -Set -Name 'Microsoft-Hyper-V' -Ensure Enabled
  implementsPretest: true
  input: stdin
  return: state

# schema:
#   embedded:
#     $schema: https://json-schema.org/draft/2020-12/schema
#     $id: file://visity.dsc.windows/feature
#     type: object
#     title: Windows Feature's status
#     description: Information about a Windows Feature's status, Enabled or Disabled

#     properties:
#       name:
#         type: 
#           $ref: #/$defs/name
#         title: Feature Name
#         description: The name of the Windows Feature
#       ensure:
#         type: 
#           $ref: #/$defs/ensure
#         title: Feature Enabled or Disabled
#         description: Desired Windows Feature state, Enabled or Disabled

#     $defs:
#       name:
#         type: string
#         minLength: 1
#       ensure:
#         type: string
#         enum:
#           - enabled
#           - disabled

#     required:
#       - name
#       - ensure

exitCodes:
  0: Success
  1: Failure
  2: Unsupported Platform
  3: Feature not found
  4: Invalid Ensure type
